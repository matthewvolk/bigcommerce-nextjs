# BigCommerce + Next.js Example Storefront

This is a [Next.js](https://nextjs.org/) example site that serves as a headless storefront for a
[BigCommerce](https://www.bigcommerce.com/) store of your choosing.

## Getting Started

First, begin by cloning this repository and installing its dependencies.

```bash
git clone git@github.com:matthewvolk/bigcommerce-nextjs.git
# then
cd bigcommerce-nextjs && yarn install
```

Next, you'll need to configure your BigCommerce Storefront to serve data to this headless
storefront.

Begin by creating a new channel for this Next.js storefront. Navigate to:
https://developer.bigcommerce.com/api-reference/store-management/channels/channels/createchannel

The request body for the endpoint above should look something like:

```json
{
  "name": "Next.js",
  "platform": "next",
  "type": "storefront",
  "status": "connected"
}
```

Next, create a Site and connect it to the channel above:
https://developer.bigcommerce.com/api-reference/store-management/sites/sites/post-site

The `url` in the request body for the endpoint above should be the storefront URL from step 1. The
`channel_id` in the request body should be the channel ID returned from the request in step 2

Finally, generate a Storefront API token for authentication with GraphQL:
https://developer.bigcommerce.com/api-reference/store-management/tokens/api-token/createtoken

The `channel_id` in the request body for the endpoint above should be the channel ID returned from
the request in step 2. The `expires_at` value in the request for the endpoint above is a timestamp
in seconds for when the token will expire. E.g.:

```javascript
new Date('12/31/2025').getTime() / 1000;
```

The `allowed_cors_origins` array in the request for the endpoint above should contain the permanent
URL for your storefront from step 1.

For more information on authenticating with GraphQL:
https://developer.bigcommerce.com/api-docs/storefront/graphql/graphql-storefront-api-overview#authentication

Finally, make a copy of `.env.example`, rename it `.env.local`, and enter the token generated by the
steps above in the `BIGCOMMERCE_STOREFRONT_API_TOKEN` environment variable.

Don't forget to also create this environment variable when you deploy this storefront to a
production server.

## Requesting Data from BigCommerce

Now that you've generated a GraphQL token, you can use Next.js's built in data fetching to fetch
data from BigCommerce and render that data in your Next.js storefront.

For example, in your `pages/index.tsx` file, export a default function called `getServerSideProps`:

```javascript
export async function getServerSideProps(context) {
  return {
    props: {}, // will be passed to the page component as props
  };
}
```

More information on `getServerSideProps` can be found in the Next.js documentation:
https://nextjs.org/docs/basic-features/data-fetching#getserversideprops-server-side-rendering

Next, use
[Next.js's built in Fetch API Polyfill](https://nextjs.org/docs/basic-features/supported-browsers-features#polyfills)
to make a request to your BigCommerce store's `/graphql` endpoint.

**IMPORTANT:** Becuase you are running requests from the perspective of another Channel, you must
use the Channel's Permament URL of the form:

```
https://store-STOREHASH-CHANNELID.mybigcommerce.com/graphql
```

For example, my example store hash is `unzvctoo8r` and the Channel ID for my Next.js channel is
`776474`. So, my Channel's permanent URL is:

```
https://store-unzvctoo8r-776474.mybigcommerce.com/graphql
```

See this example below:

```javascript
export const getServerSideProps: GetServerSideProps = async context => {
  const res = await fetch('https://store-unzvctoo8r-776474.mybigcommerce.com/graphql', {
    method: 'POST',
    credentials: 'same-origin',
    headers: {
      'Content-Type': 'application/json',
      Authorization: `Bearer ${process.env.BIGCOMMERCE_STOREFRONT_API_TOKEN}`,
    },
    body: JSON.stringify({
      query: `{
      site {
        product(entityId: 111) {
          id
          entityId
          name
          plainTextDescription
        }
      }
    }
    `,
    }),
  });
  const data = await res.json();
  const product = data.data.site.product;
  console.log(product);
  return {
    props: {
      product,
    },
  };
};
```

For more information on requesting Data from BigCommerce into your Next.js storefront, please read:
https://developer.bigcommerce.com/api-docs/storefront/graphql/graphql-storefront-api-overview

## Deployment

Personally, I deploy my Next.js projects using Vercel, mainly for their friendly user interface and
generous free plan. Read more on Vercel deployments with Next.js here:
https://nextjs.org/docs/deployment
